import{c as Dn,l as On,m as An,a as y,d as F,f as z,o as He,j as xn}from"../chunks/W4OKvgJ1.js";import{w as wt,o as tn,a as Pn}from"../chunks/sST61MHv.js";import{a as gt,H as nn,aW as sn,S as tt,h as be,a0 as an,I as mt,l as s,ap as Ln,af as Un,K as zn,U as Kt,a4 as ut,e as Ve,J as Rn,a9 as jn,R as qt,c as Fn,aX as Le,b as xt,s as Hn,C as Vt,ag as x,a7 as Lt,aM as Kn,aY as qn,aZ as Vn,a_ as Bn,r as rn,p as on,a$ as Dt,F as Gn,a2 as Jn,b0 as Yn,a6 as Wn,d as Xn,b1 as Zn,X as Qn,b2 as es,G as ts,ah as ns,t as we,x as ke,A as T,y as f,i as G,n as L,z as v,v as P,aJ as pe,b3 as ln,b4 as j,b5 as Ae,w as te,ai as O,aH as ht,an as Ot,T as ss}from"../chunks/DCd_uAEE.js";import{s as U}from"../chunks/mw6dDeEP.js";import{l as ae,p as R,s as le,i as J,a as Se,b as he,c as cn}from"../chunks/CUWMNtGJ.js";import{a as Bt,b as Oe,s as vt,c as as,d as rs}from"../chunks/CCIW6Yut.js";import"../chunks/DNsPaE8R.js";import{i as Ee}from"../chunks/BQsvaV8x.js";import{B as os}from"../chunks/-W29c7Qh.js";function nt(n,e){return e}function is(n,e,a){for(var o=[],r=e.length,i,t=e.length,l=0;l<r;l++){let u=e[l];on(u,()=>{if(i){if(i.pending.delete(u),i.done.add(u),i.pending.size===0){var m=n.outrogroups;Pt(Lt(i.done)),m.delete(i),m.size===0&&(n.outrogroups=null)}}else t-=1},!1)}if(t===0){var c=o.length===0&&a!==null;if(c){var d=a,_=d.parentNode;Wn(_),_.append(d),n.items.clear()}Pt(e,!c)}else i={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(i)}function Pt(n,e=!0){for(var a=0;a<n.length;a++)Xn(n[a],e)}var Gt;function st(n,e,a,o,r,i=null){var t=n,l=new Map,c=(e&sn)!==0;if(c){var d=n;t=be?tt(an(d)):d.appendChild(gt())}be&&mt();var _=null,u=Ln(()=>{var $=a();return Kn($)?$:$==null?[]:Lt($)}),m,k=!0;function I(){g.fallback=_,ls(g,m,t,e,o),_!==null&&(m.length===0?(_.f&Le)===0?rn(_):(_.f^=Le,dt(_,null,t)):on(_,()=>{_=null}))}var M=nn(()=>{m=s(u);var $=m.length;let V=!1;if(be){var se=Un(t)===zn;se!==($===0)&&(t=Kt(),tt(t),ut(!1),V=!0)}for(var K=new Set,re=Fn,de=Hn(),W=0;W<$;W+=1){be&&Ve.nodeType===Rn&&Ve.data===jn&&(t=Ve,V=!0,ut(!1));var ue=m[W],ne=o(ue,W),Z=k?null:l.get(ne);Z?(Z.v&&qt(Z.v,ue),Z.i&&qt(Z.i,W),de&&re.skipped_effects.delete(Z.e)):(Z=cs(l,k?t:Gt??=gt(),ue,ne,W,r,e,a),k||(Z.e.f|=Le),l.set(ne,Z)),K.add(ne)}if($===0&&i&&!_&&(k?_=xt(()=>i(t)):(_=xt(()=>i(Gt??=gt())),_.f|=Le)),be&&$>0&&tt(Kt()),!k)if(de){for(const[N,E]of l)K.has(N)||re.skipped_effects.add(E.e);re.oncommit(I),re.ondiscard(()=>{})}else I();V&&ut(!0),s(u)}),g={effect:M,items:l,outrogroups:null,fallback:_};k=!1,be&&(t=Ve)}function ls(n,e,a,o,r){var i=(o&Yn)!==0,t=e.length,l=n.items,c=n.effect.first,d,_=null,u,m=[],k=[],I,M,g,$;if(i)for($=0;$<t;$+=1)I=e[$],M=r(I,$),g=l.get(M).e,(g.f&Le)===0&&(g.nodes?.a?.measure(),(u??=new Set).add(g));for($=0;$<t;$+=1){if(I=e[$],M=r(I,$),g=l.get(M).e,n.outrogroups!==null)for(const Z of n.outrogroups)Z.pending.delete(g),Z.done.delete(g);if((g.f&Le)!==0)if(g.f^=Le,g===c)dt(g,null,a);else{var V=_?_.next:c;g===n.effect.last&&(n.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),Fe(n,_,g),Fe(n,g,V),dt(g,V,a),_=g,m=[],k=[],c=_.next;continue}if((g.f&Dt)!==0&&(rn(g),i&&(g.nodes?.a?.unfix(),(u??=new Set).delete(g))),g!==c){if(d!==void 0&&d.has(g)){if(m.length<k.length){var se=k[0],K;_=se.prev;var re=m[0],de=m[m.length-1];for(K=0;K<m.length;K+=1)dt(m[K],se,a);for(K=0;K<k.length;K+=1)d.delete(k[K]);Fe(n,re.prev,de.next),Fe(n,_,re),Fe(n,de,se),c=se,_=de,$-=1,m=[],k=[]}else d.delete(g),dt(g,c,a),Fe(n,g.prev,g.next),Fe(n,g,_===null?n.effect.first:_.next),Fe(n,_,g),_=g;continue}for(m=[],k=[];c!==null&&c!==g;)(d??=new Set).add(c),k.push(c),c=c.next;if(c===null)continue}(g.f&Le)===0&&m.push(g),_=g,c=g.next}if(n.outrogroups!==null){for(const Z of n.outrogroups)Z.pending.size===0&&(Pt(Lt(Z.done)),n.outrogroups?.delete(Z));n.outrogroups.size===0&&(n.outrogroups=null)}if(c!==null||d!==void 0){var W=[];if(d!==void 0)for(g of d)(g.f&Dt)===0&&W.push(g);for(;c!==null;)(c.f&Dt)===0&&c!==n.fallback&&W.push(c),c=c.next;var ue=W.length;if(ue>0){var ne=(o&sn)!==0&&t===0?a:null;if(i){for($=0;$<ue;$+=1)W[$].nodes?.a?.measure();for($=0;$<ue;$+=1)W[$].nodes?.a?.fix()}is(n,W,ne)}}i&&Gn(()=>{if(u!==void 0)for(g of u)g.nodes?.a?.apply()})}function cs(n,e,a,o,r,i,t,l){var c=(t&qn)!==0?(t&Vn)===0?x(a,!1,!1):Vt(a):null,d=(t&Bn)!==0?Vt(r):null;return{v:c,i:d,e:xt(()=>(i(e,c??a,d??r,l),()=>{n.delete(o)}))}}function dt(n,e,a){if(n.nodes)for(var o=n.nodes.start,r=n.nodes.end,i=e&&(e.f&Le)===0?e.nodes.start:a;o!==null;){var t=Jn(o);if(i.before(o),o===r)return;o=t}}function Fe(n,e,a){e===null?n.effect.first=a:e.next=a,a===null?n.effect.last=e:a.prev=e}function oe(n,e,a,o,r){be&&mt();var i=e.$$slots?.[a],t=!1;i===!0&&(i=e.children,t=!0),i===void 0||i(n,t?()=>o:o)}function ds(n,e,a,o,r,i){let t=be;be&&mt();var l=null;be&&Ve.nodeType===Zn&&(l=Ve,mt());var c=be?Ve:n,d=new os(c,!1);nn(()=>{const _=e()||null;var u=es;if(_===null){d.ensure(null,null);return}return d.ensure(_,m=>{if(_){if(l=be?l:document.createElementNS(u,_),Dn(l,l),o){be&&On(_)&&l.append(document.createComment(""));var k=be?an(l):l.appendChild(gt());be&&(k===null?ut(!1):tt(k)),o(l,k)}ts.nodes.end=l,m.before(l)}be&&tt(m)}),()=>{}},Qn),ns(()=>{}),t&&(ut(!0),tt(c))}const us=1,yt=2,At=3,Ut=4,vs=5,fs=6;function hs(n){return{type:"auth",access_token:n}}function gs(){return{type:"supported_features",id:1,features:{coalesce_messages:1}}}function _s(){return{type:"get_states"}}function ms(n,e,a,o,r){const i={type:"call_service",domain:n,service:e,target:o,return_response:r};return a&&(i.service_data=a),i}function ys(n){const e={type:"subscribe_events"};return n&&(e.event_type=n),e}function Jt(n){return{type:"unsubscribe_events",subscription:n}}function ps(){return{type:"ping"}}function bs(n,e){return{type:"result",success:!1,error:{code:n,message:e}}}function $s(n){const e={},a=n.split("&");for(let o=0;o<a.length;o++){const r=a[o].split("="),i=decodeURIComponent(r[0]),t=r.length>1?decodeURIComponent(r[1]):void 0;e[i]=t}return e}const dn=(n,e,a,o)=>{const[r,i,t]=n.split(".",3);return Number(r)>e||Number(r)===e&&(o===void 0?Number(i)>=a:Number(i)>a)||o!==void 0&&Number(r)===e&&Number(i)===a&&Number(t)>=o},ws="auth_invalid",ks="auth_ok";function Is(n){if(!n.auth)throw Ut;const e=n.auth;let a=e.expired?e.refreshAccessToken().then(()=>{a=void 0},()=>{a=void 0}):void 0;const o=e.wsUrl;function r(i,t,l){const c=new WebSocket(o);let d=!1;const _=()=>{if(c.removeEventListener("close",_),d){l(yt);return}if(i===0){l(us);return}const k=i===-1?-1:i-1;setTimeout(()=>r(k,t,l),1e3)},u=async k=>{try{e.expired&&await(a||e.refreshAccessToken()),c.send(JSON.stringify(hs(e.accessToken)))}catch(I){d=I===yt,c.close()}},m=async k=>{const I=JSON.parse(k.data);switch(I.type){case ws:d=!0,c.close();break;case ks:c.removeEventListener("open",u),c.removeEventListener("message",m),c.removeEventListener("close",_),c.removeEventListener("error",_),c.haVersion=I.ha_version,dn(c.haVersion,2022,9)&&c.send(JSON.stringify(gs())),t(c);break}};c.addEventListener("open",u),c.addEventListener("message",m),c.addEventListener("close",_),c.addEventListener("error",_)}return new Promise((i,t)=>r(n.setupRetry,i,t))}class Ss{constructor(e,a){this._handleMessage=o=>{let r=JSON.parse(o.data);Array.isArray(r)||(r=[r]),r.forEach(i=>{const t=this.commands.get(i.id);switch(i.type){case"event":t?t.callback(i.event):(console.warn(`Received event for unknown subscription ${i.id}. Unsubscribing.`),this.sendMessagePromise(Jt(i.id)).catch(l=>{}));break;case"result":t&&(i.success?(t.resolve(i.result),"subscribe"in t||this.commands.delete(i.id)):(t.reject(i.error),this.commands.delete(i.id)));break;case"pong":t?(t.resolve(),this.commands.delete(i.id)):console.warn(`Received unknown pong response ${i.id}`);break}})},this._handleClose=async()=>{const o=this.commands;if(this.commandId=1,this.oldSubscriptions=this.commands,this.commands=new Map,this.socket=void 0,o.forEach(t=>{"subscribe"in t||t.reject(bs(At,"Connection lost"))}),this.closeRequested)return;this.fireEvent("disconnected");const r=Object.assign(Object.assign({},this.options),{setupRetry:0}),i=t=>{setTimeout(async()=>{if(!this.closeRequested)try{const l=await r.createSocket(r);this._setSocket(l)}catch(l){if(this._queuedMessages){const c=this._queuedMessages;this._queuedMessages=void 0;for(const d of c)d.reject&&d.reject(At)}l===yt?this.fireEvent("reconnect-error",l):i(t+1)}},Math.min(t,5)*1e3)};this.suspendReconnectPromise&&(await this.suspendReconnectPromise,this.suspendReconnectPromise=void 0,this._queuedMessages=[]),i(0)},this.options=a,this.commandId=2,this.commands=new Map,this.eventListeners=new Map,this.closeRequested=!1,this._setSocket(e)}get connected(){return this.socket!==void 0&&this.socket.readyState==this.socket.OPEN}_setSocket(e){this.socket=e,this.haVersion=e.haVersion,e.addEventListener("message",this._handleMessage),e.addEventListener("close",this._handleClose);const a=this.oldSubscriptions;a&&(this.oldSubscriptions=void 0,a.forEach(r=>{"subscribe"in r&&r.subscribe&&r.subscribe().then(i=>{r.unsubscribe=i,r.resolve()})}));const o=this._queuedMessages;if(o){this._queuedMessages=void 0;for(const r of o)r.resolve()}this.fireEvent("ready")}addEventListener(e,a){let o=this.eventListeners.get(e);o||(o=[],this.eventListeners.set(e,o)),o.push(a)}removeEventListener(e,a){const o=this.eventListeners.get(e);if(!o)return;const r=o.indexOf(a);r!==-1&&o.splice(r,1)}fireEvent(e,a){(this.eventListeners.get(e)||[]).forEach(o=>o(this,a))}suspendReconnectUntil(e){this.suspendReconnectPromise=e}suspend(){if(!this.suspendReconnectPromise)throw new Error("Suspend promise not set");this.socket&&this.socket.close()}reconnect(e=!1){if(this.socket){if(!e){this.socket.close();return}this.socket.removeEventListener("message",this._handleMessage),this.socket.removeEventListener("close",this._handleClose),this.socket.close(),this._handleClose()}}close(){this.closeRequested=!0,this.socket&&this.socket.close()}async subscribeEvents(e,a){return this.subscribeMessage(e,ys(a))}ping(){return this.sendMessagePromise(ps())}sendMessage(e,a){if(!this.connected)throw At;if(this._queuedMessages){if(a)throw new Error("Cannot queue with commandId");this._queuedMessages.push({resolve:()=>this.sendMessage(e)});return}a||(a=this._genCmdId()),e.id=a,this.socket.send(JSON.stringify(e))}sendMessagePromise(e){return new Promise((a,o)=>{if(this._queuedMessages){this._queuedMessages.push({reject:o,resolve:async()=>{try{a(await this.sendMessagePromise(e))}catch(i){o(i)}}});return}const r=this._genCmdId();this.commands.set(r,{resolve:a,reject:o}),this.sendMessage(e,r)})}async subscribeMessage(e,a,o){if(this._queuedMessages&&await new Promise((i,t)=>{this._queuedMessages.push({resolve:i,reject:t})}),o?.preCheck&&!await o.preCheck())throw new Error("Pre-check failed");let r;return await new Promise((i,t)=>{const l=this._genCmdId();r={resolve:i,reject:t,callback:e,subscribe:o?.resubscribe!==!1?()=>this.subscribeMessage(e,a,o):void 0,unsubscribe:async()=>{this.connected&&await this.sendMessagePromise(Jt(l)),this.commands.delete(l)}},this.commands.set(l,r);try{this.sendMessage(a,l)}catch{}}),()=>r.unsubscribe()}_genCmdId(){return++this.commandId}}const Es=()=>`${location.protocol}//${location.host}/`,Ms=n=>n*1e3+Date.now();function Ts(){const{protocol:n,host:e,pathname:a,search:o}=location;return`${n}//${e}${a}${o}`}function Ns(n,e,a,o){let r=`${n}/auth/authorize?response_type=code&redirect_uri=${encodeURIComponent(a)}`;return e!==null&&(r+=`&client_id=${encodeURIComponent(e)}`),o&&(r+=`&state=${encodeURIComponent(o)}`),r}function Cs(n,e,a,o){a+=(a.includes("?")?"&":"?")+"auth_callback=1",document.location.href=Ns(n,e,a,o)}async function un(n,e,a){const o=typeof location<"u"&&location;if(o&&o.protocol==="https:"){const l=document.createElement("a");if(l.href=n,l.protocol==="http:"&&l.hostname!=="localhost")throw vs}const r=new FormData;e!==null&&r.append("client_id",e),Object.keys(a).forEach(l=>{r.append(l,a[l])});const i=await fetch(`${n}/auth/token`,{method:"POST",credentials:"same-origin",body:r});if(!i.ok)throw i.status===400||i.status===403?yt:new Error("Unable to fetch tokens");const t=await i.json();return t.hassUrl=n,t.clientId=e,t.expires=Ms(t.expires_in),t}function Yt(n,e,a){return un(n,e,{code:a,grant_type:"authorization_code"})}function Ds(n){return btoa(JSON.stringify(n))}function Os(n){return JSON.parse(atob(n))}class As{constructor(e,a){this.data=e,this._saveTokens=a}get wsUrl(){return`ws${this.data.hassUrl.substr(4)}/api/websocket`}get accessToken(){return this.data.access_token}get expired(){return Date.now()>this.data.expires}async refreshAccessToken(){if(!this.data.refresh_token)throw new Error("No refresh_token");const e=await un(this.data.hassUrl,this.data.clientId,{grant_type:"refresh_token",refresh_token:this.data.refresh_token});e.refresh_token=this.data.refresh_token,this.data=e,this._saveTokens&&this._saveTokens(e)}async revoke(){if(!this.data.refresh_token)throw new Error("No refresh_token to revoke");const e=new FormData;e.append("token",this.data.refresh_token),await fetch(`${this.data.hassUrl}/auth/revoke`,{method:"POST",credentials:"same-origin",body:e}),this._saveTokens&&this._saveTokens(null)}}async function xs(n={}){let e,a=n.hassUrl;a&&a[a.length-1]==="/"&&(a=a.substr(0,a.length-1));const o=n.clientId!==void 0?n.clientId:Es(),r=n.limitHassInstance===!0;if(n.authCode&&a&&(e=await Yt(a,o,n.authCode),n.saveTokens&&n.saveTokens(e)),!e){const i=$s(location.search.substr(1));if("auth_callback"in i){const t=Os(i.state);if(r&&(t.hassUrl!==a||t.clientId!==o))throw fs;e=await Yt(t.hassUrl,t.clientId,i.code),n.saveTokens&&n.saveTokens(e)}}if(!e&&n.loadTokens&&(e=await n.loadTokens()),e&&(a===void 0||e.hassUrl===a))return new As(e,n.saveTokens);if(a===void 0)throw Ut;return Cs(a,o,n.redirectUrl||Ts(),Ds({hassUrl:a,clientId:o})),new Promise(()=>{})}const Ps=n=>{let e=[];function a(r){let i=[];for(let t=0;t<e.length;t++)e[t]===r?r=null:i.push(e[t]);e=i}function o(r,i){n=i?r:Object.assign(Object.assign({},n),r);let t=e;for(let l=0;l<t.length;l++)t[l](n)}return{get state(){return n},action(r){function i(t){o(t,!1)}return function(){let t=[n];for(let c=0;c<arguments.length;c++)t.push(arguments[c]);let l=r.apply(this,t);if(l!=null)return l instanceof Promise?l.then(i):i(l)}},setState:o,clearState(){n=void 0},subscribe(r){return e.push(r),()=>{a(r)}}}},Ls=5e3,Wt=(n,e,a,o,r={unsubGrace:!0})=>{if(n[e])return n[e];let i=0,t,l,c=Ps();const d=()=>{if(!a)throw new Error("Collection does not support refresh");return a(n).then(M=>c.setState(M,!0))},_=()=>d().catch(M=>{if(n.connected)throw M}),u=()=>{if(l!==void 0){clearTimeout(l),l=void 0;return}o&&(t=o(n,c)),a&&(n.addEventListener("ready",_),_()),n.addEventListener("disconnected",I)},m=()=>{l=void 0,t&&t.then(M=>{M()}),c.clearState(),n.removeEventListener("ready",d),n.removeEventListener("disconnected",I)},k=()=>{l=setTimeout(m,Ls)},I=()=>{l&&(clearTimeout(l),m())};return n[e]={get state(){return c.state},refresh:d,subscribe(M){i++,i===1&&u();const g=c.subscribe(M);return c.state!==void 0&&setTimeout(()=>M(c.state),0),()=>{g(),i--,i||(r.unsubGrace?k():m())}}},n[e]},Us=n=>n.sendMessagePromise(_s()),Ue=(n,e,a,o,r,i)=>n.sendMessagePromise(ms(e,a,o,r,i));function zs(n,e){const a=Object.assign({},n.state);if(e.a)for(const o in e.a){const r=e.a[o];let i=new Date(r.lc*1e3).toISOString();a[o]={entity_id:o,state:r.s,attributes:r.a,context:typeof r.c=="string"?{id:r.c,parent_id:null,user_id:null}:r.c,last_changed:i,last_updated:r.lu?new Date(r.lu*1e3).toISOString():i}}if(e.r)for(const o of e.r)delete a[o];if(e.c)for(const o in e.c){let r=a[o];if(!r){console.warn("Received state update for unknown entity",o);continue}r=Object.assign({},r);const{"+":i,"-":t}=e.c[o],l=i?.a||t?.a,c=l?Object.assign({},r.attributes):r.attributes;if(i&&(i.s!==void 0&&(r.state=i.s),i.c&&(typeof i.c=="string"?r.context=Object.assign(Object.assign({},r.context),{id:i.c}):r.context=Object.assign(Object.assign({},r.context),i.c)),i.lc?r.last_updated=r.last_changed=new Date(i.lc*1e3).toISOString():i.lu&&(r.last_updated=new Date(i.lu*1e3).toISOString()),i.a&&Object.assign(c,i.a)),t?.a)for(const d of t.a)delete c[d];l&&(r.attributes=c),a[o]=r}n.setState(a,!0)}const Rs=(n,e)=>n.subscribeMessage(a=>zs(e,a),{type:"subscribe_entities"});function js(n,e){const a=n.state;if(a===void 0)return;const{entity_id:o,new_state:r}=e.data;if(r)n.setState({[r.entity_id]:r});else{const i=Object.assign({},a);delete i[o],n.setState(i,!0)}}async function Fs(n){const e=await Us(n),a={};for(let o=0;o<e.length;o++){const r=e[o];a[r.entity_id]=r}return a}const Hs=(n,e)=>n.subscribeEvents(a=>js(e,a),"state_changed"),Ks=n=>dn(n.haVersion,2022,4,0)?Wt(n,"_ent",void 0,Rs):Wt(n,"_ent",Fs,Hs),qs=(n,e)=>Ks(n).subscribe(e);async function Vs(n){const e=Object.assign({setupRetry:0,createSocket:Is},n),a=await e.createSocket(e);return new Ss(a,e)}const Me=wt({}),De=wt(null),et=wt(!1),qe=wt(null);let Pe;function vn(){if(typeof window<"u")try{const n=window.location.origin;if(window.parent!==window)try{const e=window.parent.location.origin;if(e.includes(":8123")||e.includes("home-assistant")||e.includes("homeassistant"))return e}catch{if(n.includes(":8123")||n.includes("home-assistant")||n.includes("homeassistant"))return n}if(n.includes(":8123")||n.includes("home-assistant")||n.includes("homeassistant")||window.location.hostname.includes("homeassistant")||window.location.hostname.includes("home-assistant")||window.location.pathname.includes("/hacsfiles/")||window.location.pathname.includes("/local/"))return n}catch(n){console.error("Error detecting HA URL:",n)}if(typeof window<"u"){const n=localStorage.getItem("hassUrl");if(n)return n}return"http://homeassistant.local:8123"}function fn(n){if(!n)return null;try{const e=vn();return new URL(n,e).href}catch(e){return console.error("Error building entity picture URL:",e),null}}async function Bs(){if(typeof window<"u"){const n=localStorage.getItem("hassTokens");if(n)try{const e=JSON.parse(n);if(e&&e.access_token)return console.log("Loaded saved tokens from localStorage"),e}catch(e){console.warn("Failed to parse saved tokens:",e),localStorage.removeItem("hassTokens")}}return null}async function Gs(n){if(typeof window<"u")try{localStorage.setItem("hassTokens",JSON.stringify(n)),n.hassUrl&&localStorage.setItem("hassUrl",n.hassUrl),console.log("Saved authentication tokens to localStorage")}catch(e){console.error("Failed to save tokens:",e)}}async function Js(){try{const n=vn();console.log("Connecting to Home Assistant at:",n);const e=await xs({hassUrl:n,loadTokens:Bs,saveTokens:Gs});console.log("Authentication successful, creating connection..."),Pe=await Vs({auth:e}),console.log("Connection established via createConnection"),et.set(!0),De.set(Pe),qe.set(null),qs(Pe,a=>{console.log("Received entity updates",Object.keys(a).length),Me.set(a)}),Pe.addEventListener("ready",()=>{console.log("Connection ready event"),et.set(!0),De.set(Pe),qe.set(null)}),Pe.addEventListener("disconnected",()=>{console.log("Disconnected from Home Assistant"),et.set(!1),De.set(null),qe.set("Disconnected")}),Pe.addEventListener("reconnect-error",()=>{console.error("Reconnect error"),qe.set("Reconnecting...")})}catch(n){console.error("Connection failed",n),et.set(!1),n===Ut?qe.set("Host required"):qe.set(n.message||"Connection failed - Check console")}}async function Ys(n,e,a){const o=e||new Date,r=a||new Date(Date.now()+10080*60*1e3);if(console.log("Fetching calendar events:",{entityId:n,start:o.toISOString(),end:r.toISOString(),startDate:o.toLocaleString(),endDate:r.toLocaleString()}),Pe)try{let i=function(d,_=""){if(!d)return null;if(Array.isArray(d)){if(d.length===0)return null;const u=d[0];return u&&typeof u=="object"&&(u.summary||u.start||u.end||u.title)?(console.log(`Found event array at path: ${_} with ${d.length} events`),d):null}if(typeof d=="object"){for(const u in d)if(d.hasOwnProperty(u)){const m=i(d[u],_?`${_}.${u}`:u);if(m)return m}}return null};const t=await Pe.sendMessagePromise({type:"call_service",domain:"calendar",service:"get_events",service_data:{entity_id:n,start_date_time:o.toISOString(),end_date_time:r.toISOString()},return_response:!0});console.log("Calendar service result:",JSON.stringify(t,null,2)),console.log("Result type:",typeof t),console.log("Is array:",Array.isArray(t)),console.log("Entity ID:",n);const l=i(t);if(l)return console.log(`Found ${l.length} events recursively`),l;let c=null;if(t?.response){const d=t.response;if(console.log("Found result.response:",typeof d,Array.isArray(d)),Array.isArray(d))c=d,console.log("Response is array with",c.length,"events");else if(d&&typeof d=="object")if(d[n]&&Array.isArray(d[n]))c=d[n],console.log(`Found events in response.${n}:`,c.length,"events");else if(d.events&&Array.isArray(d.events))c=d.events,console.log("Found events in response.events:",c.length,"events");else{const _=Object.keys(d);console.log("Response keys:",_);for(const u of _)if(Array.isArray(d[u])&&d[u].length>0){const m=d[u][0];if(m&&typeof m=="object"&&(m.summary||m.start||m.end||m.title)){c=d[u],console.log(`Found event array in response.${u}:`,c.length,"events");break}}}}else if(Array.isArray(t)&&t.length>0){const d=t[0];d&&typeof d=="object"&&(d.summary||d.start||d.end||d.title)&&(c=t,console.log("Result is directly an array:",c.length,"events"))}else t?.events&&Array.isArray(t.events)?(c=t.events,console.log("Found events in result.events:",c.length,"events")):t&&typeof t=="object"&&t[n]&&Array.isArray(t[n])&&(c=t[n],console.log(`Found events in result.${n}:`,c.length,"events"));return Array.isArray(c)&&c.length>0?(console.log(`Returning ${c.length} events`),c[0]&&console.log("First event structure:",Object.keys(c[0])),c):(console.log("No events found in result structure"),console.log("Result keys:",t?Object.keys(t):"null"),t?.response&&typeof t.response=="object"&&console.log("Response keys:",Object.keys(t.response)),[])}catch(i){throw console.error("Service call failed:",i),new Error(`Calendar service error: ${i.message||i.code||"Unknown error"}`)}throw new Error("Not connected to Home Assistant. Calendar events require a websocket connection.")}const Ws={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var Xs=An("<svg><!><!></svg>");function ce(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]),o=ae(a,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);we(e,!1);let r=R(e,"name",8,void 0),i=R(e,"color",8,"currentColor"),t=R(e,"size",8,24),l=R(e,"strokeWidth",8,2),c=R(e,"absoluteStrokeWidth",8,!1),d=R(e,"iconNode",24,()=>[]);const _=(...I)=>I.filter((M,g,$)=>!!M&&$.indexOf(M)===g).join(" ");Ee();var u=Xs();Bt(u,(I,M)=>({...Ws,...o,width:t(),height:t(),stroke:i(),"stroke-width":I,class:M}),[()=>(L(c()),L(l()),L(t()),G(()=>c()?Number(l())*24/Number(t()):l())),()=>(L(r()),L(a),G(()=>_("lucide-icon","lucide",r()?`lucide-${r()}`:"",a.class)))]);var m=f(u);st(m,1,d,nt,(I,M)=>{var g=pe(()=>ln(s(M),2));let $=()=>s(g)[0],V=()=>s(g)[1];var se=F(),K=P(se);ds(K,$,!0,(re,de)=>{Bt(re,()=>({...V()}))}),y(I,se)});var k=T(m);oe(k,e,"default",{}),v(u),y(n,u),ke()}function pt(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}],["path",{d:"M10 4v4"}],["path",{d:"M2 8h20"}],["path",{d:"M6 4v4"}]];ce(n,le({name:"app-window"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function Zs(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M 22 14 L 22 10"}],["rect",{x:"2",y:"6",width:"16",height:"12",rx:"2"}]];ce(n,le({name:"battery"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function Xt(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M8 2v4"}],["path",{d:"M16 2v4"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2"}],["path",{d:"M3 10h18"}]];ce(n,le({name:"calendar"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function bt(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m9 12 2 2 4-4"}]];ce(n,le({name:"circle-check"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function Qs(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];ce(n,le({name:"circle-question-mark"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function Zt(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M12 6v6l4 2"}],["circle",{cx:"12",cy:"12",r:"10"}]];ce(n,le({name:"clock"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function hn(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M10 12h.01"}],["path",{d:"M18 20V6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14"}],["path",{d:"M2 20h20"}]];ce(n,le({name:"door-closed"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function gn(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M11 20H2"}],["path",{d:"M11 4.562v16.157a1 1 0 0 0 1.242.97L19 20V5.562a2 2 0 0 0-1.515-1.94l-4-1A2 2 0 0 0 11 4.561z"}],["path",{d:"M11 4H8a2 2 0 0 0-2 2v14"}],["path",{d:"M14 12h.01"}],["path",{d:"M22 20h-3"}]];ce(n,le({name:"door-open"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function _n(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z"}],["path",{d:"M16 17h4"}],["path",{d:"M4 13h4"}]];ce(n,le({name:"footprints"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function ea(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];ce(n,le({name:"house"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function mn(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M16.8 11.2c.8-.9 1.2-2 1.2-3.2a6 6 0 0 0-9.3-5"}],["path",{d:"m2 2 20 20"}],["path",{d:"M6.3 6.3a4.67 4.67 0 0 0 1.2 5.2c.7.7 1.3 1.5 1.5 2.5"}],["path",{d:"M9 18h6"}],["path",{d:"M10 22h4"}]];ce(n,le({name:"lightbulb-off"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function ta(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"}],["path",{d:"M9 18h6"}],["path",{d:"M10 22h4"}]];ce(n,le({name:"lightbulb"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function na(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"}],["circle",{cx:"12",cy:"10",r:"3"}]];ce(n,le({name:"map-pin"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function sa(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"}]];ce(n,le({name:"moon"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function Qt(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1"}]];ce(n,le({name:"pause"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function en(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"}]];ce(n,le({name:"play"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function aa(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M12 22v-5"}],["path",{d:"M15 8V2"}],["path",{d:"M17 8a1 1 0 0 1 1 1v4a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1z"}],["path",{d:"M9 8V2"}]];ce(n,le({name:"plug"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function zt(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M12 2v10"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04"}]];ce(n,le({name:"power"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function ra(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z"}],["path",{d:"M3 20V4"}]];ce(n,le({name:"skip-back"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function oa(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M21 4v16"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z"}]];ce(n,le({name:"skip-forward"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function ia(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]];ce(n,le({name:"sun"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function la(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M3.5 21 14 3"}],["path",{d:"M20.5 21 10 3"}],["path",{d:"M15.5 21 12 15l-3.5 6"}],["path",{d:"M2 21h20"}]];ce(n,le({name:"tent"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function ca(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"}]];ce(n,le({name:"thermometer"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function yn(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];ce(n,le({name:"triangle-alert"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function da(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"m17 2-5 5-5-5"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2"}]];ce(n,le({name:"tv"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}function $t(n,e){const a=ae(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M18 21V10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v11"}],["path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 1.132-1.803l7.95-3.974a2 2 0 0 1 1.837 0l7.948 3.974A2 2 0 0 1 22 8z"}],["path",{d:"M6 13h12"}],["path",{d:"M6 17h12"}]];ce(n,le({name:"warehouse"},()=>a,{get iconNode(){return o},children:(r,i)=>{var t=F(),l=P(t);oe(l,e,"default",{}),y(r,t)},$$slots:{default:!0}}))}var ua=z('<div><div class="icon svelte-1ds1j5k"><!></div> <div class="name svelte-1ds1j5k"> </div> <div class="state svelte-1ds1j5k"> </div></div>');function va(n,e){we(e,!1);const a=()=>he(Me,"$entities",r),o=()=>he(De,"$connection",r),[r,i]=Se(),t=x(),l=x();let c=R(e,"entityId",8),d=R(e,"label",8);function _(){o()&&Ue(o(),"homeassistant","toggle",{entity_id:c()})}j(()=>(a(),L(c())),()=>{O(t,a()[c()])}),j(()=>s(t),()=>{O(l,s(t)?.state==="on")}),Ae(),Ee();var u=ua(),m=f(u),k=f(m);{var I=K=>{ta(K,{size:32})},M=K=>{mn(K,{size:32})};J(k,K=>{s(l)?K(I):K(M,!1)})}v(m);var g=T(m,2),$=f(g,!0);v(g);var V=T(g,2),se=f(V,!0);v(V),v(u),te(()=>{Oe(u,1,`tile ${s(l)?"on":"off"} glass-panel`,"svelte-1ds1j5k"),U($,(L(d()),s(t),L(c()),G(()=>d()||s(t)?.attributes.friendly_name||c()))),U(se,(s(t),G(()=>s(t)?.state||"Unknown")))}),He("click",u,_),y(n,u),ke(),i()}var fa=z('<div class="tile sensor glass-panel svelte-1mck596"><div class="header svelte-1mck596"> </div> <div class="value svelte-1mck596"> <span class="unit svelte-1mck596"> </span></div></div>');function ha(n,e){we(e,!1);const a=()=>he(Me,"$entities",o),[o,r]=Se(),i=x(),t=x(),l=x(),c=x();let d=R(e,"entityId",8),_=R(e,"label",8),u=R(e,"format",8,""),m=R(e,"unit",8,"");j(()=>(a(),L(d())),()=>{O(i,a()[d()])}),j(()=>s(i),()=>{O(t,s(i)?.state)}),j(()=>(L(m()),s(i)),()=>{O(l,m()||s(i)?.attributes.unit_of_measurement||"")}),j(()=>(L(u()),s(t)),()=>{O(c,u()==="date"&&s(t)?new Date(s(t)).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):s(t))}),Ae(),Ee();var k=fa(),I=f(k),M=f(I,!0);v(I);var g=T(I,2),$=f(g),V=T($),se=f(V,!0);v(V),v(g),v(k),te(()=>{U(M,(L(_()),s(i),L(d()),G(()=>_()||s(i)?.attributes.friendly_name||d()))),U($,`${(s(c)||"--")??""} `),U(se,s(l))}),y(n,k),ke(),r()}var ga=z('<div><div class="header svelte-d2lh25"> </div> <div class="content svelte-d2lh25"><span class="icon svelte-d2lh25"><!></span> <span class="state svelte-d2lh25"> </span></div></div>');function _a(n,e){we(e,!1);const a=()=>he(Me,"$entities",o),[o,r]=Se(),i=x(),t=x(),l=x(),c=x(),d=x();let _=R(e,"entityId",8),u=R(e,"label",8),m=R(e,"deviceClass",8,"door");function k(ne){switch(ne){case"door":return"Open";case"window":return"Open";case"motion":return"Detected";case"garage":return"Open";case"problem":return"Problem";default:return"On"}}function I(ne){switch(ne){case"door":return"Closed";case"window":return"Closed";case"motion":return"Clear";case"garage":return"Closed";case"problem":return"OK";default:return"Off"}}function M(ne){switch(ne){case"door":return gn;case"window":return pt;case"motion":return _n;case"garage":return $t;default:return yn}}function g(ne){switch(ne){case"door":return hn;case"window":return pt;case"motion":return bt;case"garage":return $t;default:return bt}}j(()=>(a(),L(_())),()=>{O(i,a()[_()])}),j(()=>s(i),()=>{O(t,s(i)?.state)}),j(()=>s(t),()=>{O(l,s(t)==="on")}),j(()=>(s(l),L(m())),()=>{O(c,s(l)?k(m()):I(m()))}),j(()=>(s(l),L(m())),()=>{O(d,s(l)?M(m()):g(m()))}),Ae(),Ee();var $=ga(),V=f($),se=f(V,!0);v(V);var K=T(V,2),re=f(K),de=f(re);cn(de,()=>s(d),(ne,Z)=>{Z(ne,{size:24})}),v(re);var W=T(re,2),ue=f(W,!0);v(W),v(K),v($),te(()=>{Oe($,1,`tile ${s(l)?"active":"inactive"} glass-panel`,"svelte-d2lh25"),U(se,(L(u()),s(i),L(_()),G(()=>u()||s(i)?.attributes.friendly_name||_()))),U(ue,s(c))}),y(n,$),ke(),r()}var ma=z('<div><div class="icon svelte-h88ioc"><!></div> <div class="name svelte-h88ioc"> </div> <div class="state svelte-h88ioc"> </div></div>');function ya(n,e){we(e,!1);const a=()=>he(Me,"$entities",r),o=()=>he(De,"$connection",r),[r,i]=Se(),t=x(),l=x();let c=R(e,"entityId",8),d=R(e,"label",8);function _(){o()&&Ue(o(),"homeassistant","toggle",{entity_id:c()})}j(()=>(a(),L(c())),()=>{O(t,a()[c()])}),j(()=>s(t),()=>{O(l,s(t)?.state==="on")}),Ae(),Ee();var u=ma(),m=f(u),k=f(m);aa(k,{size:32}),v(m);var I=T(m,2),M=f(I,!0);v(I);var g=T(I,2),$=f(g,!0);v(g),v(u),te(()=>{Oe(u,1,`tile ${s(l)?"on":"off"} glass-panel`,"svelte-h88ioc"),U(M,(L(d()),s(t),L(c()),G(()=>d()||s(t)?.attributes.friendly_name||c()))),U($,(s(t),G(()=>s(t)?.state||"Unknown")))}),He("click",u,_),y(n,u),ke(),i()}var pa=z('<img class="avatar svelte-1kgjbrn"/>'),ba=z('<span class="icon svelte-1kgjbrn"><!></span>'),$a=z('<div class="battery svelte-1kgjbrn"><span><!></span> <span> </span></div>'),wa=z('<div><div class="icon-area svelte-1kgjbrn"><!></div> <div class="info svelte-1kgjbrn"><div class="name svelte-1kgjbrn"> </div> <div class="state svelte-1kgjbrn"> </div> <!></div></div>');function ka(n,e){we(e,!1);const a=()=>he(Me,"$entities",o),[o,r]=Se(),i=x(),t=x(),l=x(),c=x(),d=x(),_=x(),u=x(),m=x();let k=R(e,"entityId",8),I=R(e,"label",8),M=R(e,"batteryEntityId",8,void 0);j(()=>(a(),L(k())),()=>{O(i,a()[k()])}),j(()=>s(i),()=>{O(t,s(i)?.state)}),j(()=>s(t),()=>{O(l,s(t)==="home")}),j(()=>s(i),()=>{O(c,s(i)?.attributes.entity_picture)}),j(()=>s(c),()=>{O(d,fn(s(c)))}),j(()=>(L(M()),a()),()=>{O(_,M()?a()[M()]:null)}),j(()=>s(_),()=>{O(u,(()=>{if(!s(_)||!s(_).state||s(_).state==="unavailable"||s(_).state==="unknown")return null;const E=parseFloat(s(_).state);return isNaN(E)?null:E})())}),j(()=>s(_),()=>{O(m,s(_)?.attributes.unit_of_measurement||"%")}),j(()=>(L(M()),s(_),a(),s(u),s(m)),()=>{M()&&(s(_)?console.log(`Battery entity ${M()}:`,{state:s(_).state,level:s(u),unit:s(m)}):console.warn(`Battery entity "${M()}" not found in entities. Available entities:`,Object.keys(a()).filter(E=>E.includes("battery")||E.includes("phone"))))}),Ae(),Ee();var g=wa(),$=f(g),V=f($);{var se=E=>{var h=pa();te(()=>{vt(h,"src",s(d)),vt(h,"alt",I())}),y(E,h)},K=E=>{var h=ba(),b=f(h);{var C=q=>{ea(q,{size:24})},Q=q=>{la(q,{size:24})};J(b,q=>{s(l)?q(C):q(Q,!1)})}v(h),y(E,h)};J(V,E=>{s(d)?E(se):E(K,!1)})}v($);var re=T($,2),de=f(re),W=f(de,!0);v(de);var ue=T(de,2),ne=f(ue,!0);v(ue);var Z=T(ue,2);{var N=E=>{var h=$a(),b=f(h);let C;var Q=f(b);Zs(Q,{size:14}),v(b);var q=T(b,2),H=f(q);v(q),v(h),te(X=>{C=Oe(b,1,"battery-icon svelte-1kgjbrn",null,C,{low:s(u)<20}),U(H,`${X??""}${s(m)??""}`)},[()=>(s(u),G(()=>Math.round(s(u))))]),y(E,h)};J(Z,E=>{s(u)!==null&&E(N)})}v(re),v(g),te(()=>{Oe(g,1,`tile ${s(l)?"home":"away"} glass-panel`,"svelte-1kgjbrn"),U(W,(L(I()),s(i),L(k()),G(()=>I()||s(i)?.attributes.friendly_name||k()))),U(ne,s(t)||"Unknown")}),y(n,g),ke(),r()}var Ia=z('<div class="artist svelte-l11nk0"> </div>'),Sa=z('<div class="temperature svelte-l11nk0"><!> </div>'),Ea=z('<div><div class="bg-overlay svelte-l11nk0"></div> <div class="content svelte-l11nk0"><div class="header svelte-l11nk0"><div class="header-left svelte-l11nk0"><span class="icon"><!></span> <span class="label"> </span></div> <div class="header-right svelte-l11nk0"><button class="btn-icon power svelte-l11nk0"><!></button></div></div> <div class="info svelte-l11nk0"><div class="text-info"><div class="title svelte-l11nk0"> </div> <!></div> <div class="controls svelte-l11nk0"><!> <button class="btn-control svelte-l11nk0"><!></button> <button class="btn-control play-pause svelte-l11nk0"><!></button> <button class="btn-control svelte-l11nk0"><!></button></div></div></div></div>');function Ma(n,e){we(e,!1);const a=()=>he(Me,"$entities",r),o=()=>he(De,"$connection",r),[r,i]=Se(),t=x(),l=x(),c=x(),d=x(),_=x(),u=x(),m=x(),k=x(),I=x(),M=x();let g=R(e,"entityId",8),$=R(e,"label",8),V=R(e,"temperatureEntityId",8,void 0);function se(Y){Y.stopPropagation(),o()&&Ue(o(),"media_player","media_play_pause",{entity_id:g()})}function K(Y){Y.stopPropagation(),o()&&Ue(o(),"media_player","media_next_track",{entity_id:g()})}function re(Y){Y.stopPropagation(),o()&&Ue(o(),"media_player","media_previous_track",{entity_id:g()})}function de(Y){Y.stopPropagation(),o()&&Ue(o(),"media_player","toggle",{entity_id:g()})}j(()=>(a(),L(g())),()=>{O(t,a()[g()])}),j(()=>s(t),()=>{O(l,s(t)?.state)}),j(()=>s(l),()=>{O(c,s(l)==="playing")}),j(()=>s(t),()=>{O(d,s(t)?.attributes||{})}),j(()=>s(d),()=>{O(_,s(d).media_title||s(d).source||"No Media")}),j(()=>s(d),()=>{O(u,s(d).media_artist||s(d).media_series_title||"")}),j(()=>s(d),()=>{O(m,s(d).entity_picture)}),j(()=>s(m),()=>{O(k,fn(s(m)))}),j(()=>(L(V()),a()),()=>{O(I,V()?a()[V()]:null)}),j(()=>s(I),()=>{O(M,s(I)?`${s(I).state}${s(I).attributes.unit_of_measurement||"°C"}`:null)}),Ae(),Ee();var W=Ea();let ue;var ne=T(f(W),2),Z=f(ne),N=f(Z),E=f(N),h=f(E);{var b=Y=>{en(Y,{size:16,fill:"currentColor"})},C=Y=>{var $e=F(),ve=P($e);{var _e=ge=>{Qt(ge,{size:16,fill:"currentColor"})},me=ge=>{da(ge,{size:16})};J(ve,ge=>{s(l)==="paused"?ge(_e):ge(me,!1)},!0)}y(Y,$e)};J(h,Y=>{s(l)==="playing"?Y(b):Y(C,!1)})}v(E);var Q=T(E,2),q=f(Q,!0);v(Q),v(N);var H=T(N,2),X=f(H),ie=f(X);zt(ie,{size:20}),v(X),v(H),v(Z);var ye=T(Z,2),p=f(ye),w=f(p),S=f(w,!0);v(w);var B=T(w,2);{var D=Y=>{var $e=Ia(),ve=f($e,!0);v($e),te(()=>U(ve,s(u))),y(Y,$e)};J(B,Y=>{s(u)&&Y(D)})}v(p);var ee=T(p,2),fe=f(ee);{var Ke=Y=>{var $e=Sa(),ve=f($e);ca(ve,{size:14,class:"temp-icon"});var _e=T(ve);v($e),te(()=>U(_e,` ${s(M)??""}`)),y(Y,$e)};J(fe,Y=>{s(M)&&Y(Ke)})}var Te=T(fe,2),Be=f(Te);ra(Be,{size:24,fill:"currentColor"}),v(Te);var A=T(Te,2),Ge=f(A);{var at=Y=>{Qt(Y,{size:32,fill:"currentColor"})},rt=Y=>{en(Y,{size:32,fill:"currentColor"})};J(Ge,Y=>{s(c)?Y(at):Y(rt,!1)})}v(A);var xe=T(A,2),Ne=f(xe);oa(Ne,{size:24,fill:"currentColor"}),v(xe),v(ee),v(ye),v(ne),v(W),te(()=>{Oe(W,1,`tile ${s(l)??""} glass-panel`,"svelte-l11nk0"),ue=as(W,"",ue,{"--bg-image":s(k)?`url('${s(k)}')`:"none"}),U(q,(L($()),s(d),G(()=>$()||s(d).friendly_name||"Media"))),U(S,s(_))}),He("click",X,de),He("click",Te,re),He("click",A,se),He("click",xe,K),y(n,W),ke(),i()}var Ta=z('<div><div class="icon svelte-1kbr3j6"><!></div> <div class="name svelte-1kbr3j6"> </div> <div class="state svelte-1kbr3j6"> </div></div>');function Na(n,e){we(e,!1);const a=()=>he(Me,"$entities",r),o=()=>he(De,"$connection",r),[r,i]=Se(),t=x(),l=x();let c=R(e,"entityId",8),d=R(e,"label",8,"");function _(){o()&&Ue(o(),"input_boolean","toggle",{entity_id:c()})}j(()=>(a(),L(c())),()=>{O(t,a()[c()])}),j(()=>s(t),()=>{O(l,s(t)?.state==="on")}),Ae(),Ee();var u=Ta(),m=f(u),k=f(m);zt(k,{size:32}),v(m);var I=T(m,2),M=f(I,!0);v(I);var g=T(I,2),$=f(g,!0);v(g),v(u),te(()=>{Oe(u,1,rs(s(l)?"tile on glass-panel":"tile off glass-panel"),"svelte-1kbr3j6"),U(M,(L(d()),s(t),L(c()),G(()=>d()||s(t)?.attributes.friendly_name||c()))),U($,(s(t),G(()=>s(t)?.state||"Unknown")))}),He("click",u,_),y(n,u),ke(),i()}var Ca=z('<div><div class="icon svelte-tiial9"><!></div> <div class="name svelte-tiial9"> </div> <div class="state svelte-tiial9"> </div></div>');function Da(n,e){we(e,!1);const a=()=>he(Me,"$entities",r),o=()=>he(De,"$connection",r),[r,i]=Se(),t=x(),l=x();let c=R(e,"entityId",8),d=R(e,"label",8,"");function _(){if(!o())return;const V=s(l)?"turn_off":"turn_on";Ue(o(),"homeassistant",V,{entity_id:c()})}j(()=>(a(),L(c())),()=>{O(t,a()[c()])}),j(()=>s(t),()=>{O(l,s(t)?.state==="on")}),Ae(),Ee();var u=Ca(),m=f(u),k=f(m);zt(k,{size:32}),v(m);var I=T(m,2),M=f(I,!0);v(I);var g=T(I,2),$=f(g,!0);v(g),v(u),te(()=>{Oe(u,1,`tile ${s(l)?"on":"off"} glass-panel`,"svelte-tiial9"),U(M,(L(d()),s(t),L(c()),G(()=>d()||s(t)?.attributes.friendly_name||c()))),U($,(s(t),G(()=>s(t)?.state||"Unknown")))}),He("click",u,_),y(n,u),ke(),i()}var Oa=z('<h3 class="title svelte-3p7m1a"> </h3>'),Aa=z(', <span class="active-count svelte-3p7m1a"> </span>',1),xa=z(', <span class="unavailable-count svelte-3p7m1a"> </span>',1),Pa=z('<div class="summary svelte-3p7m1a"> <!> <!></div>'),La=z('<div class="header svelte-3p7m1a"><!> <!></div>'),Ua=z('<div class="empty-state svelte-3p7m1a"><p>No sensors available</p></div>'),za=z('<div><div class="icon svelte-3p7m1a"><!></div> <div class="name svelte-3p7m1a"> </div> <div class="state svelte-3p7m1a"> </div></div>'),Ra=z('<div class="status-grid svelte-3p7m1a"></div>'),ja=z('<div class="status-grid-container svelte-3p7m1a"><!> <!></div>');function Fa(n,e){we(e,!1);const a=()=>he(Me,"$entities",o),[o,r]=Se(),i=x(),t=x();let l=R(e,"entityIds",24,()=>[]),c=R(e,"labels",24,()=>({})),d=R(e,"deviceClass",8,"door"),_=R(e,"deviceClasses",24,()=>({})),u=R(e,"title",8,""),m=R(e,"showSummary",8,!1),k=R(e,"hideUnavailable",8,!1),I=R(e,"sortByState",8,!0);function M(N){switch(N){case"door":return"Open";case"window":return"Open";case"motion":return"Detected";case"garage":return"Open";case"problem":return"Problem";default:return"On"}}function g(N){switch(N){case"door":return"Closed";case"window":return"Closed";case"motion":return"Clear";case"garage":return"Closed";case"problem":return"OK";default:return"Off"}}function $(N){switch(N){case"door":return gn;case"window":return pt;case"motion":return _n;case"garage":return $t;default:return yn}}function V(N){switch(N){case"door":return hn;case"window":return pt;case"motion":return bt;case"garage":return $t;default:return bt}}function se(N,E,h){return!N||N==="unavailable"||N==="unknown"?N==="unavailable"?"Unavailable":"Unknown":h?M(E):g(E)}function K(N,E,h){return!N||N==="unavailable"||N==="unknown"?Qs:h?$(E):V(E)}j(()=>(L(l()),a(),L(_()),L(d()),L(k()),L(c()),L(I())),()=>{O(i,l().map(N=>{const E=a()[N],h=_()[N]??E?.attributes?.device_class??d(),b=E?.state,C=b==="on",Q=!b||b==="unavailable"||b==="unknown";return k()&&Q?null:{id:N,entity:E,label:c()[N]??E?.attributes?.friendly_name??N,deviceClass:h,state:b,isOn:C,isUnavailable:Q,stateLabel:se(b,h,C),IconComponent:K(b,h,C)}}).filter(N=>N!==null).sort((N,E)=>{if(I()){if(N.isUnavailable&&!E.isUnavailable)return-1;if(!N.isUnavailable&&E.isUnavailable)return 1;if(N.isOn&&!E.isOn)return-1;if(!N.isOn&&E.isOn)return 1}return 0}))}),j(()=>(L(m()),s(i)),()=>{O(t,m()?(()=>{const N=s(i).length,E=s(i).filter(b=>b.isOn).length,h=s(i).filter(b=>b.isUnavailable).length;return{total:N,active:E,unavailable:h}})():null)}),Ae(),Ee();var re=ja(),de=f(re);{var W=N=>{var E=La(),h=f(E);{var b=q=>{var H=Oa(),X=f(H,!0);v(H),te(()=>U(X,u())),y(q,H)};J(h,q=>{u()&&q(b)})}var C=T(h,2);{var Q=q=>{var H=Pa(),X=f(H),ie=T(X);{var ye=S=>{var B=Aa(),D=T(P(B)),ee=f(D);v(D),te(()=>U(ee,`${s(t),G(()=>s(t).active)??""} active`)),y(S,B)};J(ie,S=>{s(t),G(()=>s(t).active>0)&&S(ye)})}var p=T(ie,2);{var w=S=>{var B=xa(),D=T(P(B)),ee=f(D);v(D),te(()=>U(ee,`${s(t),G(()=>s(t).unavailable)??""} unavailable`)),y(S,B)};J(p,S=>{s(t),G(()=>s(t).unavailable>0)&&S(w)})}v(H),te(()=>U(X,`${s(t),G(()=>s(t).total)??""} ${s(t),G(()=>s(t).total===1?"sensor":"sensors")??""} `)),y(q,H)};J(C,q=>{s(t)&&q(Q)})}v(E),y(N,E)};J(de,N=>{(u()||s(t))&&N(W)})}var ue=T(de,2);{var ne=N=>{var E=Ua();y(N,E)},Z=N=>{var E=Ra();st(E,5,()=>s(i),nt,(h,b)=>{let C=()=>s(b).label,Q=()=>s(b).isOn,q=()=>s(b).isUnavailable,H=()=>s(b).stateLabel,X=()=>s(b).IconComponent;var ie=za(),ye=f(ie),p=f(ye);cn(p,X,(ee,fe)=>{fe(ee,{size:24})}),v(ye);var w=T(ye,2),S=f(w,!0);v(w);var B=T(w,2),D=f(B,!0);v(B),v(ie),te(()=>{Oe(ie,1,`tile glass-panel ${q()?"unavailable":Q()?"active":"inactive"}`,"svelte-3p7m1a"),vt(ie,"title",`${C()??""}: ${H()??""}`),U(S,C()),U(D,H())}),y(h,ie)}),v(E),y(N,E)};J(ue,N=>{s(i),G(()=>s(i).length===0)?N(ne):N(Z,!1)})}v(re),y(n,re),ke(),r()}var Ha=z('<div class="header svelte-aryo9e"><div class="title svelte-aryo9e"><!> <span> </span></div></div>'),Ka=z('<div class="loading svelte-aryo9e">Loading events...</div>'),qa=z('<div class="error svelte-aryo9e"> </div>'),Va=z('<div class="empty svelte-aryo9e">No upcoming events <div class="debug-info" style="font-size: 0.7rem; opacity: 0.5; margin-top: 0.5rem;"> </div></div>'),Ba=z('<span class="time-separator svelte-aryo9e">–</span> ',1),Ga=z('<span class="duration svelte-aryo9e"> </span>'),Ja=z('<div class="event-time svelte-aryo9e"><!> <span> <!></span> <!></div>'),Ya=z('<div class="event-time svelte-aryo9e"><!> <span> </span></div>'),Wa=z('<div class="event-location svelte-aryo9e"><!> <span> </span></div>'),Xa=z('<div class="event glass-panel svelte-aryo9e"><div class="event-date-time svelte-aryo9e"><div class="event-date svelte-aryo9e"><!> <span> </span></div> <!></div> <div class="event-title svelte-aryo9e"> </div> <!></div>'),Za=z('<div class="events-list svelte-aryo9e"></div>'),Qa=z('<div class="tile calendar glass-panel svelte-aryo9e"><!> <div class="content svelte-aryo9e"><!></div></div>');function er(n,e){we(e,!1);const a=()=>he(et,"$connected",r),o=()=>he(De,"$connection",r),[r,i]=Se();let t=R(e,"entityId",8),l=R(e,"label",8,""),c=R(e,"maxEvents",8,5),d=R(e,"daysAhead",8,7),_=R(e,"showTitle",8,!0),u=x([]),m=x(!0),k=x(null),I=null,M=x(!1);async function g(){a()||await new Promise(h=>setTimeout(h,1e3));try{O(m,!0),O(k,null);const h=new Date;h.setHours(0,0,0,0);const b=new Date(Date.now()+d()*24*60*60*1e3);b.setHours(23,59,59,999),console.log("Calendar date range:",{start:h.toISOString(),end:b.toISOString(),daysAhead:d()});const C=await Ys(t(),h,b);console.log("Fetched events:",C),console.log("Number of events:",C.length),C.length>0&&console.log("First event:",C[0]);const Q=new Date,q=new Date(Q.getFullYear(),Q.getMonth(),Q.getDate(),0,0,0,0),H=q.getTime();O(u,C.map(p=>{const w=typeof p.start=="string"?p.start:p.start?.dateTime||p.start?.date;if(!w)return{event:p,sortKey:1/0,dayKey:1/0};let S,B;if(w.includes("T")){S=new Date(w);const D=S.getFullYear(),ee=S.getMonth(),fe=S.getDate();B=new Date(D,ee,fe,0,0,0,0).getTime()}else{const[D,ee,fe]=w.split("-").map(Number);S=new Date(D,ee-1,fe,0,0,0,0),B=S.getTime()}return{event:p,sortKey:S.getTime(),dayKey:B,sortDate:S}}).sort((p,w)=>{const S=p.dayKey-w.dayKey;if(S!==0)return S;const B=$(p.event),D=$(w.event);return B&&!D?-1:!B&&D?1:p.sortKey-w.sortKey}).map(p=>p.event).slice(0,c())),console.log("Today start:",q.toISOString(),"dayKey:",H),console.log("Raw fetched events:",C);const ie=C.map(p=>{const w=typeof p.start=="string"?p.start:p.start?.dateTime||p.start?.date;if(!w)return{event:p,sortKey:1/0,dayKey:1/0};let S,B;if(w.includes("T")){S=new Date(w);const D=S.getFullYear(),ee=S.getMonth(),fe=S.getDate();B=new Date(D,ee,fe,0,0,0,0).getTime()}else{const[D,ee,fe]=w.split("-").map(Number);S=new Date(D,ee-1,fe,0,0,0,0),B=S.getTime()}return{event:p,sortKey:S.getTime(),dayKey:B}}).map(p=>({summary:p.event.summary||p.event.title,start:typeof p.event.start=="string"?p.event.start:p.event.start?.dateTime||p.event.start?.date,dayKey:p.dayKey,dayKeyDate:new Date(p.dayKey).toLocaleDateString(),sortKey:p.sortKey}));console.log("Mapped events (before sort):",ie),console.table(ie),ie.forEach((p,w)=>{console.log(`Event ${w}: "${p.summary}" - dayKey: ${p.dayKey} (${p.dayKeyDate}), todayDayKey: ${H}, match: ${p.dayKey===H?"TODAY":p.dayKey>H?"FUTURE":"PAST"}`)});const ye=s(u).map(p=>{const w=typeof p.start=="string"?p.start:p.start?.dateTime||p.start?.date;let S;if(w?.includes("T"))S=new Date(w);else if(w){const[B,D,ee]=w.split("-").map(Number);S=new Date(B,D-1,ee,0,0,0,0)}else S=new Date(0);return{summary:p.summary||p.title,dateLabel:V(p),start:w,eventDate:S.toISOString(),eventDateLocal:S.toLocaleString(),isAllDay:$(p)}});console.log("Sorted events order:",ye),console.table(ye),console.log("Processed events:",s(u).length)}catch(h){const b=h.message||"Failed to load events";O(k,b),console.error("Calendar fetch error:",h),console.error("Entity ID:",t()),console.error("Error details:",{message:h.message,stack:h.stack,name:h.name}),O(u,[])}finally{O(m,!1)}}function $(h){const b=typeof h.start=="string"?h.start:h.start?.date||h.start?.dateTime||h.start_time||h.dtstart||h.start;return b?typeof b=="string"&&!b.includes("T")&&!b.includes(" ")&&!!b.match(/^\d{4}-\d{2}-\d{2}$/):!1}function V(h){const b=typeof h.start=="string"?h.start:h.start?.dateTime||h.start?.date||h.start_time||h.dtstart||h.start;if(!b)return console.warn("No start date found in event:",h),"";try{const C=new Date(b);if(isNaN(C.getTime()))return console.warn("Invalid date:",b),"";const Q=new Date,q=new Date(Q.getFullYear(),Q.getMonth(),Q.getDate()),H=new Date(C.getFullYear(),C.getMonth(),C.getDate());if(H.getTime()===q.getTime())return"Today";const X=new Date(q);if(X.setDate(X.getDate()+1),H.getTime()===X.getTime())return"Tomorrow";const ie=Math.floor((H.getTime()-q.getTime())/(1e3*60*60*24));return ie>=0&&ie<7?C.toLocaleDateString("en-US",{weekday:"long"}):C.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}catch(C){return console.error("Error formatting date:",C,b),""}}function se(h){const b=typeof h.start=="string"?h.start:h.start?.dateTime||h.start?.date||h.start_time||h.dtstart||h.start;if(!b)return"";if($(h))return"All day";try{const C=new Date(b);return isNaN(C.getTime())?"":C.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(C){return console.error("Error formatting time:",C,b),""}}function K(h){const b=typeof h.end=="string"?h.end:h.end?.dateTime||h.end?.date||h.end_time||h.dtend||h.end;if(!b||$(h))return"";try{const C=new Date(b);return isNaN(C.getTime())?"":C.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(C){return console.error("Error formatting end time:",C,b),""}}function re(h){const b=typeof h.start=="string"?h.start:h.start?.dateTime||h.start?.date,C=typeof h.end=="string"?h.end:h.end?.dateTime||h.end?.date;if(!b||!C)return"";const Q=new Date(b),H=new Date(C).getTime()-Q.getTime(),X=H/(1e3*60*60);return X<1?`${Math.round(H/6e4)}m`:X<24?`${Math.round(X*10)/10}h`:`${Math.round(X/24)}d`}tn(()=>{g(),I=setInterval(()=>{O(M,!1),g()},300*1e3)}),Pn(()=>{I&&clearInterval(I)}),j(()=>(a(),o(),s(M)),()=>{a()&&o()&&!s(M)&&(O(M,!0),g())}),Ae(),Ee();var de=Qa(),W=f(de);{var ue=h=>{var b=Ha(),C=f(b),Q=f(C);Xt(Q,{size:18});var q=T(Q,2),H=f(q,!0);v(q),v(C),v(b),te(()=>U(H,l()||"Calendar")),y(h,b)};J(W,h=>{_()&&h(ue)})}var ne=T(W,2),Z=f(ne);{var N=h=>{var b=Ka();y(h,b)},E=h=>{var b=F(),C=P(b);{var Q=H=>{var X=qa(),ie=f(X,!0);v(X),te(()=>U(ie,s(k))),y(H,X)},q=H=>{var X=F(),ie=P(X);{var ye=w=>{var S=Va(),B=T(f(S)),D=f(B);v(B),v(S),te(()=>U(D,`Events fetched: ${s(u),G(()=>s(u).length)??""}`)),y(w,S)},p=w=>{var S=Za();st(S,5,()=>s(u),nt,(B,D)=>{var ee=Xa(),fe=f(ee),Ke=f(fe),Te=f(Ke);Xt(Te,{size:12});var Be=T(Te,2),A=f(Be,!0);v(Be),v(Ke);var Ge=T(Ke,2);{var at=ve=>{var _e=Ja(),me=f(_e);Zt(me,{size:12});var ge=T(me,2),ze=f(ge),ot=T(ze);{var kt=Ie=>{var je=Ba(),it=T(P(je));te(Ce=>U(it,` ${Ce??""}`),[()=>(s(D),G(()=>K(s(D))))]),y(Ie,je)};J(ot,Ie=>{s(D),G(()=>K(s(D)))&&Ie(kt)})}v(ge);var Re=T(ge,2);{var ft=Ie=>{var je=Ga(),it=f(je);v(je),te(Ce=>U(it,`(${Ce??""})`),[()=>(s(D),G(()=>re(s(D))))]),y(Ie,je)};J(Re,Ie=>{s(D),G(()=>re(s(D)))&&Ie(ft)})}v(_e),te(Ie=>U(ze,`${Ie??""} `),[()=>(s(D),G(()=>se(s(D))||"Time TBD"))]),y(ve,_e)},rt=ve=>{var _e=Ya(),me=f(_e);Zt(me,{size:12});var ge=T(me,2),ze=f(ge,!0);v(ge),v(_e),te(ot=>U(ze,ot),[()=>(s(D),G(()=>se(s(D))||"All day"))]),y(ve,_e)};J(Ge,ve=>{s(D),G(()=>!$(s(D)))?ve(at):ve(rt,!1)})}v(fe);var xe=T(fe,2),Ne=f(xe,!0);v(xe);var Y=T(xe,2);{var $e=ve=>{var _e=Wa(),me=f(_e);na(me,{size:24});var ge=T(me,2),ze=f(ge,!0);v(ge),v(_e),te(()=>U(ze,(s(D),G(()=>s(D).location)))),y(ve,_e)};J(Y,ve=>{s(D),G(()=>s(D).location)&&ve($e)})}v(ee),te(ve=>{U(A,ve),U(Ne,(s(D),G(()=>s(D).summary||s(D).title||"Untitled Event")))},[()=>(s(D),G(()=>V(s(D))||"Date TBD"))]),y(B,ee)}),v(S),y(w,S)};J(ie,w=>{s(u),G(()=>s(u).length===0)?w(ye):w(p,!1)},!0)}y(H,X)};J(C,H=>{s(k)?H(Q):H(q,!1)},!0)}y(h,b)};J(Z,h=>{s(m)?h(N):h(E,!1)})}v(ne),v(de),y(n,de),ke(),i()}const _t={people:[{entityId:"person.artfuldoidger",label:"Mat",batteryEntityId:"sensor.mats_iphone_battery_level"},{entityId:"person.jessi",label:"Jess",batteryEntityId:"sensor.jessi_battery_level"}],rooms:{Security:[{type:"statusGrid",entityIds:["binary_sensor.frontdoor_contact_sensor_contact"],labels:{"binary_sensor.frontdoor_contact_sensor_contact":"Front Door"},deviceClass:"door",showSummary:!1},{type:"arm",entityId:"input_boolean.nighttime_door_warning",label:"Arm Door Sensors"}],Calendar:[{type:"calendar",entityId:"calendar.mat_and_jessi",label:"Upcoming Events",maxEvents:5,daysAhead:1,showTitle:!1}],"Living Room":[{type:"media",entityId:"media_player.living_room_tv",label:"TV"},{type:"switch",entityId:"switch.innr_smart_plug_1",label:"Xmas TreeSmart Plug"}],"Master Bedroom":[{type:"light",entityId:"light.bedroom_lamp",label:"Mat Bedroom Lamp"},{type:"light",entityId:"light.mat_and_jess_light",label:"Mat & Jess Light Strip"},{type:"switch",entityId:"switch.0x0017880108e74ea6",label:"Mat & Jess Smart Plug"},{type:"media",entityId:"media_player.main_bedroom",label:"Apple TV"}],"Kids' Rooms":[{type:"light",entityId:"light.ellies_room",label:"Ellie's Light Bar"},{type:"media",entityId:"media_player.ellie_s_daddy_s_house",label:"Ellie's Yoto",temperatureEntityId:"sensor.ellie_s_daddy_s_house_temperature"},{type:"light",entityId:"light.poppys_light_strip_2",label:"Poppy's Light"},{type:"media",entityId:"media_player.poppy_s_yoto",label:"Poppy's Yoto",temperatureEntityId:"sensor.poppy_s_yoto_temperature"},{type:"light",entityId:"light.bens_bedside_lamp",label:"Ben's Lamp"}],Hallway:[{type:"binary_sensor",entityId:"binary_sensor.frontdoor_contact_sensor_contact",label:"Front Door",deviceClass:"door"},{type:"light",entityId:"light.hallway",label:"Hallway Light"}],Network:[{type:"sensor",entityId:"sensor.ucg_ultra_state",label:"UCG Ultra State"},{type:"sensor",entityId:"sensor.atom",label:"Atom Wifi",unit:"Clients"},{type:"sensor",entityId:"sensor.cerebro",label:"Cerebro Wifi",unit:"Clients"},{type:"sensor",entityId:"sensor.ucg_ultra_ucg_ultra_cpu_temperature",label:"UCG Ultra CPU Temp",unit:"°C"}],"Raspberry Pi Server":[{type:"sensor",entityId:"sensor.system_monitor_last_boot",label:"Last Boot",format:"date"},{type:"sensor",entityId:"sensor.system_monitor_disk_use",label:"Disk Use",unit:"%"},{type:"sensor",entityId:"sensor.system_monitor_disk_free",label:"Disk Free",unit:"GB"},{type:"sensor",entityId:"sensor.system_monitor_processor_temperature",label:"Processor Temp",unit:"°C"}]}};let Qe=null;async function tr(){if(Qe)return Qe;try{const n=await fetch("/config.json");if(n.ok){const e=await n.json();return console.log("Loaded user config from /config.json"),Qe={people:e.people||_t.people,rooms:{..._t.rooms,...e.rooms}},Qe}}catch(n){console.log("No user config found, using defaults:",n)}return Qe=_t,Qe}function nr(){return _t}var sr=z('<div class="status error svelte-1uha8ag"> </div>'),ar=z("<div> </div>"),rr=z('<div><div class="people"><div class="people-grid svelte-1uha8ag"></div></div></div>'),or=z('<div class="status-grid-wrapper svelte-1uha8ag"><!></div>'),ir=z('<div class="calendar-tile-wrapper svelte-1uha8ag"><!></div>'),lr=z('<section class="section svelte-1uha8ag"><h2 class="svelte-1uha8ag"> </h2> <div class="grid svelte-1uha8ag"></div></section>'),cr=z('<div class="dashboard-container svelte-1uha8ag"><header class="svelte-1uha8ag"><div class="header-left svelte-1uha8ag"><div class="clock svelte-1uha8ag"><span class="time svelte-1uha8ag"> </span> <span class="date svelte-1uha8ag"> </span></div> <div class="status-container svelte-1uha8ag"><!> <button class="master-switch glass-panel svelte-1uha8ag" title="Turn Off All Lights &amp; Plugs"><!> <span>All Off</span></button> <button class="dark-mode-toggle glass-panel svelte-1uha8ag"><!></button></div></div> <!></header> <main><main></main></main></div>');function pr(n,e){we(e,!0);const a=()=>he(De,"$connection",t),o=()=>he(Me,"$entities",t),r=()=>he(qe,"$connectionError",t),i=()=>he(et,"$connected",t),[t,l]=Se();let c=ht(Ot(new Date)),d=pe(()=>s(c).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})),_=pe(()=>s(c).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})),u=ht(!1),m=ht(Ot([])),k=ht(Ot({}));function I(){O(u,!s(u)),typeof window<"u"&&(localStorage.setItem("darkMode",s(u).toString()),document.documentElement.classList.toggle("dark",s(u)))}tn(()=>{console.log("Alakazam Dashboard: Initializing..."),console.log("Current URL:",typeof window<"u"?window.location.href:"N/A"),tr().then(w=>{O(m,w.people,!0),O(k,w.rooms,!0),console.log("Configuration loaded:",{people:s(m).length,rooms:Object.keys(s(k)).length})}).catch(w=>{console.error("Failed to load config, using defaults:",w);const S=nr();O(m,S.people,!0),O(k,S.rooms,!0)});try{Js()}catch(w){console.error("Error connecting to HA:",w)}const p=setInterval(()=>{O(c,new Date,!0)},1e3);if(typeof window<"u"){const w=localStorage.getItem("darkMode")==="true";O(u,w),w&&document.documentElement.classList.add("dark")}return()=>clearInterval(p)});function M(){if(!a())return;const p=Object.keys(o()).filter(w=>(w.startsWith("light.")||w.startsWith("switch."))&&o()[w].state==="on");p.length>0&&Ue(a(),"homeassistant","turn_off",{entity_id:p})}var g=cr(),$=f(g),V=f($),se=f(V),K=f(se),re=f(K,!0);v(K);var de=T(K,2),W=f(de,!0);v(de),v(se);var ue=T(se,2),ne=f(ue);{var Z=p=>{var w=sr(),S=f(w,!0);v(w),te(()=>{vt(w,"title",r()),U(S,r())}),y(p,w)},N=p=>{var w=ar();let S;var B=f(w,!0);v(w),te(()=>{S=Oe(w,1,"status svelte-1uha8ag",null,S,{connected:i()}),U(B,i()?"Connected":"Connecting...")}),y(p,w)};J(ne,p=>{r()?p(Z):p(N,!1)})}var E=T(ne,2);E.__click=M;var h=f(E);mn(h,{size:20}),ss(2),v(E);var b=T(E,2);b.__click=I;var C=f(b);{var Q=p=>{ia(p,{size:20})},q=p=>{sa(p,{size:20})};J(C,p=>{s(u)?p(Q):p(q,!1)})}v(b),v(ue),v(V);var H=T(V,2);{var X=p=>{var w=rr(),S=f(w),B=f(S);st(B,21,()=>s(m),nt,(D,ee)=>{ka(D,{get entityId(){return s(ee).entityId},get label(){return s(ee).label},get batteryEntityId(){return s(ee).batteryEntityId}})}),v(B),v(S),v(w),y(p,w)};J(H,p=>{s(m).length>0&&p(X)})}v($);var ie=T($,2),ye=f(ie);st(ye,21,()=>Object.entries(s(k)),nt,(p,w)=>{var S=pe(()=>ln(s(w),2));let B=()=>s(S)[0],D=()=>s(S)[1];var ee=lr(),fe=f(ee),Ke=f(fe,!0);v(fe);var Te=T(fe,2);st(Te,21,D,nt,(Be,A)=>{var Ge=F(),at=P(Ge);{var rt=Ne=>{va(Ne,{get entityId(){return s(A).entityId},get label(){return s(A).label}})},xe=Ne=>{var Y=F(),$e=P(Y);{var ve=me=>{ha(me,{get entityId(){return s(A).entityId},get label(){return s(A).label},get unit(){return s(A).unit},get format(){return s(A).format}})},_e=me=>{var ge=F(),ze=P(ge);{var ot=Re=>{_a(Re,{get entityId(){return s(A).entityId},get label(){return s(A).label},get deviceClass(){return s(A).deviceClass}})},kt=Re=>{var ft=F(),Ie=P(ft);{var je=Ce=>{ya(Ce,{get entityId(){return s(A).entityId},get label(){return s(A).label}})},it=Ce=>{var Rt=F(),pn=P(Rt);{var bn=Je=>{Na(Je,{get entityId(){return s(A).entityId},get label(){return s(A).label}})},$n=Je=>{var jt=F(),wn=P(jt);{var kn=Ye=>{Da(Ye,{get entityId(){return s(A).entityId},get label(){return s(A).label}})},In=Ye=>{var Ft=F(),Sn=P(Ft);{var En=We=>{Ma(We,{get entityId(){return s(A).entityId},get label(){return s(A).label},get temperatureEntityId(){return s(A).temperatureEntityId}})},Mn=We=>{var Ht=F(),Tn=P(Ht);{var Nn=Xe=>{var Ze=or(),It=f(Ze);{let St=pe(()=>s(A).entityIds??[]),lt=pe(()=>s(A).labels??{}),ct=pe(()=>s(A).deviceClass??"door"),Et=pe(()=>s(A).deviceClasses??{}),Mt=pe(()=>s(A).title??""),Tt=pe(()=>s(A).showSummary??!1),Nt=pe(()=>s(A).hideUnavailable??!1),Ct=pe(()=>s(A).sortByState??!0);Fa(It,{get entityIds(){return s(St)},get labels(){return s(lt)},get deviceClass(){return s(ct)},get deviceClasses(){return s(Et)},get title(){return s(Mt)},get showSummary(){return s(Tt)},get hideUnavailable(){return s(Nt)},get sortByState(){return s(Ct)}})}v(Ze),y(Xe,Ze)},Cn=Xe=>{var Ze=F(),It=P(Ze);{var St=lt=>{var ct=ir(),Et=f(ct);{let Mt=pe(()=>s(A).label??""),Tt=pe(()=>s(A).maxEvents??5),Nt=pe(()=>s(A).daysAhead??7),Ct=pe(()=>s(A).showTitle!==void 0?s(A).showTitle:!0);er(Et,{get entityId(){return s(A).entityId},get label(){return s(Mt)},get maxEvents(){return s(Tt)},get daysAhead(){return s(Nt)},get showTitle(){return s(Ct)}})}v(ct),y(lt,ct)};J(It,lt=>{s(A).type==="calendar"&&lt(St)},!0)}y(Xe,Ze)};J(Tn,Xe=>{s(A).type==="statusGrid"?Xe(Nn):Xe(Cn,!1)},!0)}y(We,Ht)};J(Sn,We=>{s(A).type==="media"?We(En):We(Mn,!1)},!0)}y(Ye,Ft)};J(wn,Ye=>{s(A).type==="automation"?Ye(kn):Ye(In,!1)},!0)}y(Je,jt)};J(pn,Je=>{s(A).type==="arm"?Je(bn):Je($n,!1)},!0)}y(Ce,Rt)};J(Ie,Ce=>{s(A).type==="switch"?Ce(je):Ce(it,!1)},!0)}y(Re,ft)};J(ze,Re=>{s(A).type==="binary_sensor"?Re(ot):Re(kt,!1)},!0)}y(me,ge)};J($e,me=>{s(A).type==="sensor"?me(ve):me(_e,!1)},!0)}y(Ne,Y)};J(at,Ne=>{s(A).type==="light"?Ne(rt):Ne(xe,!1)})}y(Be,Ge)}),v(Te),v(ee),te(()=>U(Ke,B())),y(p,ee)}),v(ye),v(ie),v(g),te(()=>{U(re,s(d)),U(W,s(_)),vt(b,"title",s(u)?"Switch to Light Mode":"Switch to Dark Mode")}),y(n,g),ke(),l()}xn(["click"]);export{pr as component};
